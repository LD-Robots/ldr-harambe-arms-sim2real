<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

    <!-- Public args so launches can change them -->
    <xacro:arg name="robot_name" default="arm_description"/>
    <xacro:arg name="mesh_dir" default="$(find arm_description)/meshes"/>
    <xacro:arg name="collision_dir" default="$(find arm_description)/collision"/>

    <!-- Bring in base structure -->
    <xacro:include filename="$(find arm_description)/urdf/arm_base.xacro" />

    <!-- ros2_control interfaces for Gazebo simulation -->
    <!-- Load ros2_control macro -->
    <xacro:include filename="$(find arm_description)/urdf/macros/ros2_control.xacro"/>
    <xacro:arm_ros2_control hand_type="$(arg hand_type)"/>

    <!-- Depth Camera -->
    <xacro:include filename="$(find arm_description)/urdf/macros/depth_camera.xacro"/>
    <!-- Mount camera on base_link, positioned to view the workspace -->
    <!-- The new robot has the table at z=0, arm starts at table level -->
    <!-- Position camera 0.5m behind and 0.8m above the robot base, looking down slightly -->
    <xacro:depth_camera parent_link="base_link" xyz="-0.3 0.0 0.8" rpy="0 ${pi/6} 0" name="camera"/>

    <!-- Gazebo plugins -->
    <gazebo>
        <plugin filename="libgz_ros2_control-system.so" name="gz_ros2_control::GazeboSimROS2ControlPlugin">
            <robot_param_node>robot_state_publisher</robot_param_node>
            <parameters>$(find arm_gazebo)/config/controllers.yaml</parameters>
        </plugin>
        <!-- Sensors plugin (required for cameras, depth sensors, etc.) -->
        <plugin filename="gz-sim-sensors-system" name="gz::sim::systems::Sensors">
            <render_engine>ogre2</render_engine>
        </plugin>
    </gazebo>

</robot>
